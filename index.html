<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Global Obesity Changes</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.2/lodash.min.js"></script>
  </head>
  <body>
    <style>
      .male {
        stroke: blue;
      }
      .female {
        stroke: pink;
      }
      .both {
        fill: yellow;
      }
      .line {
        fill: none;
        /*stroke: yellow;*/
        stroke-width: 1.5px;
      }
    </style>
    <script>
    var svg = d3.select("body").append("svg")
      .attr("width", 600)
      .attr("height", 300);
    var scale = d3.scale.linear()
      .domain([0.3, 0])
      .range([0, 300]);

    var scaleYear = d3.scale.linear()
      .domain([1990, 2013])
      .range([0, 600]);

    d3.csv("obesity.csv", function(data) {
      data = _.filter(data, ["location_name", "Canada"])
      _.remove(data, ["sex", "both"])
      _.remove(data, ["metric", "overweight"]);

    groupData = d3.nest()
      .key(function(d) { return d.sex; })
      .key(function(d) { return d.age_group_id; })
      .entries(data);
    console.log(groupData);


    var sexGroup = svg.selectAll(".sex")
      .data(groupData)
      .enter().append("g")
        .attr("class", "sex");

    var ageGroup = sexGroup.selectAll(".age")
        .data(function(d) { return (d.values); })
        .enter().append("g")
          .attr("class", "age");

    var line = d3.svg.line()
        .x(function(d){ return scaleYear(+d.year)})
        .y(function(d) { return scale(+d.mean)});

    ageGroup.append("path")
      .attr("class", function(d) { return "line " + d.values[0].sex})
      .attr("d", function(d) { return line(d.values); })
      // .attr("d", line);

    // points
    //   .attr("cx", function(d){ return scaleYear(+d.year)})
    //   .attr("cy", function(d) { return scale(+d.mean)})
    //   .attr("class", function(d) { return d.sex })
    });
    </script>

  </body>
</html>
